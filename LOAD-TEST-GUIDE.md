# 부하 테스트 및 오토스케일링 데모 가이드

## 🎯 목적

웹 페이지에서 부하 테스트를 실행하고, 인스턴스가 자동으로 확장되는 것을 실시간으로 확인합니다.

---

## 📋 준비 사항

### 1. 인스턴스 개수 모니터링 설정 (각 VM에서 실행)

각 VM 인스턴스에 SSH 접속 후:

```bash
cd /home/pjwp0928w/football-ticketing-system

# 스크립트 실행 권한 부여
chmod +x setup-instance-monitoring.sh
chmod +x get-instance-count.sh
chmod +x update-instance-count.sh

# 모니터링 설정 실행
./setup-instance-monitoring.sh
```

### 2. 애플리케이션 재시작

```bash
sudo systemctl restart football-app
```

---

## 🚀 사용 방법

### 1. 웹 페이지 접속

```
http://[로드밸런서_IP]/
```

### 2. 로그인

- 회원가입 후 로그인
- 또는 기존 계정으로 로그인

### 3. 모니터링 위젯 확인

로그인하면 오른쪽 상단에 **실시간 모니터링 위젯**이 표시됩니다:

- CPU 사용률
- 메모리 사용률
- **🖥️ 활성 인스턴스 개수** ← 여기서 확인!

### 4. 부하 테스트 시작

모니터링 위젯 하단의 **부하 테스트** 섹션:

1. **🚀 부하 시작** 버튼 클릭
2. 초당 100개의 요청이 서버로 전송됨
3. 요청 수, 성공, 실패 통계 실시간 표시

### 5. 오토스케일링 확인

부하 테스트 시작 후:

- **5-10분 대기**
- 모니터링 위젯의 **활성 인스턴스** 개수 확인
- 2개 → 3개 → 4개 → 5개로 증가하는 것을 확인

### 6. 부하 중지

- **⏹️ 부하 중지** 버튼 클릭
- 10-15분 후 인스턴스가 다시 2개로 감소

---

## 📊 GCP Console에서 확인

### 인스턴스 그룹 모니터링

1. **Compute Engine** → **인스턴스 그룹** → `football-app-group-v2`
2. **모니터링** 탭:
   - CPU 사용률 그래프
   - 인스턴스 개수 변화
3. **멤버** 탭:
   - 실시간 인스턴스 목록
   - 각 인스턴스 상태 (HEALTHY)

### 로드밸런서 모니터링

1. **네트워크 서비스** → **부하 분산** → `football-load-balancer`
2. **모니터링** 탭:
   - 요청 수 그래프
   - 백엔드 지연 시간
   - 트래픽 분산 상태

---

## 🎬 데모 시나리오

### 시나리오 1: 기본 오토스케일링

1. 웹 페이지 접속 및 로그인
2. 현재 인스턴스 개수 확인 (2개)
3. 부하 테스트 시작
4. 5분 대기
5. 인스턴스 개수 증가 확인 (3-5개)
6. 부하 중지
7. 15분 후 인스턴스 감소 확인 (2개)

### 시나리오 2: 티켓 예매 + 부하 테스트

1. 로그인 후 경기 목록 확인
2. 티켓 예매 (좌석 선택)
3. 동시에 부하 테스트 시작
4. 예매 완료 확인
5. 인스턴스 증가 확인

---

## 🔧 문제 해결

### 인스턴스 개수가 "N/A"로 표시되는 경우

**원인**: 인스턴스 모니터링 스크립트가 설정되지 않음

**해결**:

```bash
cd /home/pjwp0928w/football-ticketing-system
./setup-instance-monitoring.sh
sudo systemctl restart football-app
```

### 부하 테스트 후에도 인스턴스가 증가하지 않는 경우

**원인**:

- 로드밸런서를 통한 트래픽이 아님
- CPU 사용률이 목표치(60%)에 도달하지 않음

**해결**:

1. 부하 테스트를 더 오래 실행 (10분 이상)
2. GCP Console에서 CPU 사용률 확인
3. 필요시 목표 CPU 사용률을 낮춤 (60% → 30%)

### 모니터링 위젯이 표시되지 않는 경우

**원인**: 로그인하지 않음

**해결**: 회원가입 후 로그인

---

## 📝 참고사항

- 인스턴스 개수는 **1분마다** 업데이트됩니다
- 오토스케일링은 **5-10분**의 안정화 시간이 필요합니다
- 최소 인스턴스: 2개
- 최대 인스턴스: 5개
- 목표 CPU 사용률: 60%

---

## 🎓 과제 발표 시 강조할 포인트

1. **실시간 모니터링**: 웹 페이지에서 인스턴스 개수를 실시간으로 확인
2. **부하 테스트**: 버튼 클릭만으로 부하 생성
3. **오토스케일링**: 자동으로 인스턴스가 증가/감소
4. **로드밸런싱**: 여러 인스턴스에 트래픽 분산
5. **실제 동작하는 애플리케이션**: 티켓 예매 시스템
